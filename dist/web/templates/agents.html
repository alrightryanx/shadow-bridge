{% extends "base.html" %}

{% block title %}Shadow Web - Agents{% endblock %}
{% block page_title %}Agent Team{% endblock %}

{% block content %}
<!-- Agent Metrics -->
<div class="stats-grid small">
    <div class="stat-card">
        <div class="stat-info">
            <span class="stat-value" id="total-agents">-</span>
            <span class="stat-label">Total Agents</span>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-info">
            <span class="stat-value" id="active-agents">-</span>
            <span class="stat-label">Active</span>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-info">
            <span class="stat-value" id="idle-agents">-</span>
            <span class="stat-label">Idle</span>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-info">
            <span class="stat-value" id="tasks-completed">-</span>
            <span class="stat-label">Tasks Done</span>
        </div>
    </div>
</div>

<!-- Agent Cards -->
<section class="section">
    <h2>Agent Roster</h2>
    <div class="agents-grid" id="agents-container">
        <div class="loading">Loading agents...</div>
    </div>
</section>

<!-- Active Tasks -->
<section class="section">
    <h2>Active Tasks</h2>
    <div class="tasks-list" id="active-tasks">
        <div class="empty-state">No active tasks</div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadAgents();
    loadMetrics();
});

async function loadAgents() {
    const agents = await api.getAgents();
    const container = document.getElementById('agents-container');

    if (agents.length === 0) {
        container.innerHTML = '<div class="empty-state">No agents configured</div>';
        return;
    }

    container.innerHTML = agents.map(a => `
        <div class="agent-card">
            <div class="agent-header">
                <div class="agent-avatar">${a.name.charAt(0)}</div>
                <div class="agent-info">
                    <div class="agent-name">${escapeHtml(a.name)}</div>
                    <span class="status-badge ${a.status}">${a.status}</span>
                </div>
            </div>
            <div class="agent-specialty">${escapeHtml(a.specialty || 'General purpose')}</div>
            ${a.current_task ? `
                <div class="agent-task">
                    <span class="task-label">Current:</span>
                    <span class="task-name">${escapeHtml(a.current_task)}</span>
                </div>
            ` : ''}
            <div class="agent-stats">
                <span>${a.tasks_completed} tasks completed</span>
            </div>
        </div>
    `).join('');

    // Update active tasks
    const activeTasks = agents.filter(a => a.current_task).map(a => ({
        agent: a.name,
        task: a.current_task
    }));

    const tasksContainer = document.getElementById('active-tasks');
    if (activeTasks.length === 0) {
        tasksContainer.innerHTML = '<div class="empty-state">No active tasks</div>';
    } else {
        tasksContainer.innerHTML = activeTasks.map(t => `
            <div class="task-item">
                <span class="task-agent">${escapeHtml(t.agent)}</span>
                <span class="task-name">${escapeHtml(t.task)}</span>
            </div>
        `).join('');
    }
}

async function loadMetrics() {
    const metrics = await api.getAgentMetrics();
    document.getElementById('total-agents').textContent = metrics.total_agents || 0;
    document.getElementById('active-agents').textContent = metrics.active_agents || 0;
    document.getElementById('idle-agents').textContent = metrics.idle_agents || 0;
    document.getElementById('tasks-completed').textContent = metrics.total_tasks_completed || 0;
}
</script>
{% endblock %}
