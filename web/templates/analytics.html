{% extends "base.html" %}

{% block title %}Shadow Web - Analytics{% endblock %}
{% block page_title %}Analytics{% endblock %}

{% block content %}
<!-- Privacy & Compliance Section -->
<section class="section">
    <h2>Privacy & Compliance</h2>
    <div class="privacy-grid">
        <!-- Privacy Score -->
        <div class="privacy-card">
            <div class="privacy-score-container">
                <div class="privacy-score-ring" id="privacy-ring">
                    <svg viewBox="0 0 120 120">
                        <circle class="ring-bg" cx="60" cy="60" r="50"/>
                        <circle class="ring-fill" cx="60" cy="60" r="50" id="privacy-ring-fill"/>
                    </svg>
                    <div class="privacy-score-value" id="privacy-score">--</div>
                </div>
                <div class="privacy-score-label">Privacy Score</div>
                <div class="privacy-status" id="privacy-status">Calculating...</div>
            </div>
        </div>

        <!-- Risk Level -->
        <div class="privacy-card">
            <div class="risk-indicator">
                <div class="risk-badge" id="risk-badge">
                    <span class="risk-level" id="risk-level">--</span>
                </div>
                <div class="risk-label">Risk Level</div>
                <div class="risk-details" id="risk-details">
                    <span class="risk-stat"><span id="risk-violations">0</span> violations</span>
                    <span class="risk-stat"><span id="risk-warnings">0</span> warnings</span>
                </div>
            </div>
        </div>

        <!-- Token Usage -->
        <div class="privacy-card">
            <div class="token-stats">
                <div class="token-total">
                    <span class="token-value" id="total-tokens">0</span>
                    <span class="token-label">Total Tokens</span>
                </div>
                <div class="token-breakdown">
                    <div class="token-item">
                        <span class="token-type">Input</span>
                        <span class="token-count" id="input-tokens">0</span>
                    </div>
                    <div class="token-item">
                        <span class="token-type">Output</span>
                        <span class="token-count" id="output-tokens">0</span>
                    </div>
                    <div class="token-item">
                        <span class="token-type">Avg/Query</span>
                        <span class="token-count" id="avg-tokens">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Audit Categories -->
<section class="section">
    <h2>Audit Categories</h2>
    <div class="category-breakdown" id="categories-container">
        <div class="loading">Loading...</div>
    </div>
</section>

<!-- Usage Stats -->
<section class="section">
    <h2>Message Usage</h2>
    <div class="usage-card">
        <div class="usage-header">
            <span class="usage-tier" id="usage-tier">Free</span>
            <span class="usage-count"><span id="messages-used">0</span> / <span id="messages-limit">100</span></span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="usage-progress" style="width: 0%"></div>
        </div>
        <div class="usage-footer">
            <span id="reset-date"></span>
        </div>
    </div>
</section>

<!-- Backend Usage -->
<section class="section">
    <h2>Backend Usage</h2>
    <div class="backends-chart" id="backends-container">
        <div class="loading">Loading...</div>
    </div>
</section>

<!-- Activity Timeline -->
<section class="section">
    <h2>Recent Activity</h2>
    <div class="activity-timeline" id="activity-container">
        <div class="empty-state">No recent activity</div>
    </div>
</section>

<!-- ========== System Health ========== -->

<!-- Health Score Section -->
<section class="section">
    <h2>System Health</h2>
    <div class="privacy-grid">
        <!-- Overall Score -->
        <div class="privacy-card">
            <div class="privacy-score-container">
                <div class="privacy-score-ring">
                    <svg viewBox="0 0 120 120">
                        <circle class="ring-bg" cx="60" cy="60" r="50"/>
                        <circle class="ring-fill" cx="60" cy="60" r="50" id="health-ring-fill"
                                style="stroke-dasharray: 314; stroke-dashoffset: 314;"/>
                    </svg>
                    <div class="privacy-score-value" id="health-score">--</div>
                </div>
                <div class="privacy-score-label">Overall Health</div>
                <div class="privacy-status" id="health-status">Loading...</div>
            </div>
        </div>

        <!-- Categories -->
        <div class="privacy-card">
            <div style="width: 100%;">
                <h3 style="margin-bottom: 16px; text-align: center;">Category Breakdown</h3>
                <div class="health-category-bars">
                    <div class="health-bar-item">
                        <span class="health-bar-label">API Reliability</span>
                        <div class="health-bar-bg"><div class="health-bar-fill" id="bar-api"></div></div>
                        <span class="health-bar-val" id="val-api">--</span>
                    </div>
                    <div class="health-bar-item">
                        <span class="health-bar-label">Response Time</span>
                        <div class="health-bar-bg"><div class="health-bar-fill" id="bar-perf"></div></div>
                        <span class="health-bar-val" id="val-perf">--</span>
                    </div>
                    <div class="health-bar-item">
                        <span class="health-bar-label">Agent Stability</span>
                        <div class="health-bar-bg"><div class="health-bar-fill" id="bar-agent"></div></div>
                        <span class="health-bar-val" id="val-agent">--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="privacy-card">
            <div style="width: 100%;">
                <h3 style="margin-bottom: 16px; text-align: center;">Quick Stats</h3>
                <div class="health-stat-grid">
                    <div class="health-stat">
                        <span class="health-stat-value" id="stat-requests">--</span>
                        <span class="health-stat-label">Requests (24h)</span>
                    </div>
                    <div class="health-stat">
                        <span class="health-stat-value" id="stat-success-rate">--</span>
                        <span class="health-stat-label">Success Rate</span>
                    </div>
                    <div class="health-stat">
                        <span class="health-stat-value" id="stat-avg-time">--</span>
                        <span class="health-stat-label">Avg Response</span>
                    </div>
                    <div class="health-stat">
                        <span class="health-stat-value" id="stat-agents">--</span>
                        <span class="health-stat-label">Active Agents</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Active Alerts Section -->
<section class="section">
    <h2>Active Alerts</h2>
    <div id="alerts-container" class="alerts-list">
        <div class="empty-state">Loading alerts...</div>
    </div>
</section>

<!-- Crash Patterns Section -->
<section class="section">
    <h2>Top Crash Patterns</h2>
    <div id="patterns-container" class="patterns-list">
        <div class="empty-state">Loading patterns...</div>
    </div>
</section>

<!-- Circuit Breaker Status -->
<section class="section">
    <h2>Circuit Breaker Status</h2>
    <div id="circuit-container" class="circuit-grid">
        <div class="empty-state">Loading...</div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Analytics
    loadPrivacyScore();
    loadTokenUsage();
    loadCategories();
    loadUsage();
    loadBackends();
    loadActivity();

    // Health
    loadHealthScore();
    loadAlerts();
    loadPatterns();
    loadCircuitBreakers();

    // Auto-refresh health every 30s
    setInterval(loadHealthScore, 30000);
});

// ========== Analytics Functions ==========

async function loadPrivacyScore() {
    try {
        const data = await api.getPrivacyScore();

        // Update score - API returns privacy_score
        const score = data.privacy_score || 0;
        document.getElementById('privacy-score').textContent = score + '%';

        // Update ring animation
        const ringFill = document.getElementById('privacy-ring-fill');
        const circumference = 2 * Math.PI * 50;
        ringFill.style.strokeDasharray = circumference;
        ringFill.style.strokeDashoffset = circumference * (1 - score / 100);

        // Update status
        let status = 'Excellent';
        let statusClass = 'status-excellent';
        if (score < 50) { status = 'Poor'; statusClass = 'status-poor'; }
        else if (score < 70) { status = 'Fair'; statusClass = 'status-fair'; }
        else if (score < 90) { status = 'Good'; statusClass = 'status-good'; }

        const statusEl = document.getElementById('privacy-status');
        statusEl.textContent = status;
        statusEl.className = 'privacy-status ' + statusClass;

        // Update risk level
        const riskLevel = data.risk_level || 'MINIMAL';
        const riskBadge = document.getElementById('risk-badge');
        document.getElementById('risk-level').textContent = riskLevel;
        riskBadge.className = 'risk-badge risk-' + riskLevel.toLowerCase();

        document.getElementById('risk-violations').textContent = data.pii_access_count || 0;
        document.getElementById('risk-warnings').textContent = data.encrypted_access_count || 0;
    } catch (e) {
        console.error('Failed to load privacy score:', e);
    }
}

async function loadTokenUsage() {
    try {
        const data = await api.getTokenUsage();

        document.getElementById('total-tokens').textContent = formatNumber(data.total_tokens || 0);
        document.getElementById('input-tokens').textContent = formatNumber(data.input_tokens || 0);
        document.getElementById('output-tokens').textContent = formatNumber(data.output_tokens || 0);
        document.getElementById('avg-tokens').textContent = formatNumber(data.avg_per_query || 0);
    } catch (e) {
        console.error('Failed to load token usage:', e);
    }
}

async function loadCategories() {
    try {
    const raw = await api.getCategoryBreakdown();
    const categories = raw.categories || raw;
    const container = document.getElementById('categories-container');

    if (!categories || categories.length === 0) {
        container.innerHTML = '<div class="empty-state">No category data</div>';
        return;
    }

    const categoryIcons = {
        'AI_DECISION': '<span class="material-symbols-outlined">smart_toy</span>',
        'DATA_ACCESS': '<span class="material-symbols-outlined">database</span>',
        'SECURITY': '<span class="material-symbols-outlined">security</span>',
        'PRIVACY': '<span class="material-symbols-outlined">visibility_off</span>',
        'SYNC': '<span class="material-symbols-outlined">sync</span>',
        'AUTOMATION': '<span class="material-symbols-outlined">auto_awesome</span>',
        'USER_ACTION': '<span class="material-symbols-outlined">person</span>'
    };

    const categoryColors = {
        'AI_DECISION': 'var(--md-sys-color-primary)',
        'DATA_ACCESS': 'var(--md-sys-color-tertiary)',
        'SECURITY': 'var(--md-sys-color-error)',
        'PRIVACY': 'var(--accent)',
        'SYNC': 'var(--success)',
        'AUTOMATION': 'var(--warning)',
        'USER_ACTION': 'var(--md-sys-color-secondary)'
    };

    container.innerHTML = categories.map(c => `
        <div class="category-item">
            <div class="category-icon" style="background: ${categoryColors[c.category] || 'var(--md-sys-color-primary)'}">${categoryIcons[c.category] || '<span class="material-symbols-outlined">category</span>'}</div>
            <div class="category-info">
                <span class="category-name">${escapeHtml(c.category.replace(/_/g, ' '))}</span>
                <div class="category-bar">
                    <div class="category-fill" style="width: ${c.percent}%; background: ${categoryColors[c.category] || 'var(--md-sys-color-primary)'}"></div>
                </div>
            </div>
            <span class="category-count">${c.count}</span>
        </div>
    `).join('');
    } catch (e) {
        console.error('Failed to load categories:', e);
        document.getElementById('categories-container').innerHTML = '<div class="empty-state">Failed to load categories</div>';
    }
}

function formatNumber(num) {
    if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
    if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
    return num.toString();
}

async function loadUsage() {
    try {
        const usage = await api.getUsageStats();
        const used = usage.messages_used || 0;
        const limit = usage.messages_limit || 100;
        const pct = limit > 0 ? Math.round(used / limit * 100) : 0;

        document.getElementById('usage-tier').textContent = (usage.tier || 'free').charAt(0).toUpperCase() + (usage.tier || 'free').slice(1);
        document.getElementById('messages-used').textContent = used;
        document.getElementById('messages-limit').textContent = limit;
        document.getElementById('usage-progress').style.width = pct + '%';

        if (usage.reset_date) {
            document.getElementById('reset-date').textContent = 'Resets: ' + usage.reset_date;
        }
    } catch (e) {
        console.error('Failed to load usage:', e);
    }
}

async function loadBackends() {
    try {
        const raw = await api.getBackendUsage();
        const backends = Array.isArray(raw) ? raw : (raw.backends || []);
        const container = document.getElementById('backends-container');

        if (backends.length === 0) {
            container.innerHTML = '<div class="empty-state">No backend usage data</div>';
            return;
        }

        container.innerHTML = backends.map(b => `
            <div class="backend-row">
                <span class="backend-name">${escapeHtml(b.name)}</span>
                <div class="backend-bar">
                    <div class="backend-fill" style="width: ${b.percent}%"></div>
                </div>
                <span class="backend-count">${b.count}</span>
            </div>
        `).join('');
    } catch (e) {
        console.error('Failed to load backends:', e);
        document.getElementById('backends-container').innerHTML = '<div class="empty-state">Failed to load backend data</div>';
    }
}

async function loadActivity() {
    try {
        const raw = await api.getActivityTimeline();
        const activity = Array.isArray(raw) ? raw : (raw.activity || []);
        const container = document.getElementById('activity-container');

        if (activity.length === 0) {
            container.innerHTML = '<div class="empty-state">No recent activity</div>';
            return;
        }

        container.innerHTML = activity.map(a => `
            <div class="activity-item">
                <div class="activity-dot"></div>
                <div class="activity-content">
                    <span class="activity-text">${escapeHtml(a.description)}</span>
                    <span class="activity-time">${a.time_ago}</span>
                </div>
            </div>
        `).join('');
    } catch (e) {
        console.error('Failed to load activity:', e);
        document.getElementById('activity-container').innerHTML = '<div class="empty-state">No recent activity</div>';
    }
}

// ========== Health Functions ==========

function getBarColor(value) {
    if (value >= 80) return '#22c55e';
    if (value >= 50) return '#f59e0b';
    return '#ef4444';
}

async function loadHealthScore() {
    try {
        const resp = await fetch('/api/health/score');
        const data = await resp.json();

        // Update score ring
        const score = data.overall || 0;
        document.getElementById('health-score').textContent = Math.round(score);

        const fill = document.getElementById('health-ring-fill');
        const offset = 314 - (314 * score / 100);
        fill.style.strokeDashoffset = offset;
        fill.style.stroke = getBarColor(score);

        document.getElementById('health-status').textContent =
            (data.status || 'unknown').charAt(0).toUpperCase() + (data.status || '').slice(1);

        // Update category bars
        const cats = data.categories || {};
        updateBar('bar-api', 'val-api', cats.api_reliability);
        updateBar('bar-perf', 'val-perf', cats.response_performance);
        updateBar('bar-agent', 'val-agent', cats.agent_stability);

        // Update stats
        const raw = data.raw || {};
        document.getElementById('stat-requests').textContent = raw.total_requests || 0;
        document.getElementById('stat-success-rate').textContent = (raw.success_rate || 0) + '%';
        document.getElementById('stat-avg-time').textContent = (raw.avg_response_time_ms || 0) + 'ms';
        document.getElementById('stat-agents').textContent =
            (raw.active_agents || 0) + '/' + (raw.total_agents || 0);
    } catch (e) {
        console.error('Failed to load health score:', e);
    }
}

function updateBar(barId, valId, value) {
    const bar = document.getElementById(barId);
    const val = document.getElementById(valId);
    if (bar && val && value !== undefined) {
        bar.style.width = value + '%';
        bar.style.background = getBarColor(value);
        val.textContent = Math.round(value);
    }
}

async function loadAlerts() {
    try {
        const resp = await fetch('/api/health/alerts');
        const data = await resp.json();
        const container = document.getElementById('alerts-container');

        if (!data.alerts || data.alerts.length === 0) {
            container.innerHTML = '<div class="empty-state">No active alerts - system healthy</div>';
            return;
        }

        container.innerHTML = data.alerts.map(a => `
            <div class="alert-card ${(a.severity || '').toLowerCase()}">
                <div class="alert-header">
                    <span class="alert-metric">${escapeHtml(a.metric_name || 'Unknown')}</span>
                    <span class="alert-severity">${escapeHtml(a.severity || '?')}</span>
                </div>
                <div class="alert-message">${escapeHtml(a.message || '')}</div>
                <div class="alert-recommendation">${escapeHtml(a.recommendation || '')}</div>
            </div>
        `).join('');
    } catch (e) {
        document.getElementById('alerts-container').innerHTML =
            '<div class="empty-state">Failed to load alerts</div>';
    }
}

async function loadPatterns() {
    try {
        const resp = await fetch('/api/health/patterns');
        const data = await resp.json();
        const container = document.getElementById('patterns-container');

        if (!data.patterns || data.patterns.length === 0) {
            container.innerHTML = '<div class="empty-state">No crash patterns recorded</div>';
            return;
        }

        container.innerHTML = data.patterns.map(p => `
            <div class="pattern-card">
                <div class="pattern-header">
                    <span class="pattern-error">${escapeHtml(p.error_type || 'Unknown')}</span>
                    <span class="pattern-count">${p.occurrence_count || 0}x</span>
                </div>
                <div class="pattern-file">${escapeHtml(p.file_name || '?')}:${escapeHtml(p.line_range || '?')}</div>
                <div class="pattern-dates">
                    First: ${escapeHtml(p.first_seen || '?')} | Last: ${escapeHtml(p.last_seen || '?')}
                </div>
            </div>
        `).join('');
    } catch (e) {
        document.getElementById('patterns-container').innerHTML =
            '<div class="empty-state">Failed to load patterns</div>';
    }
}

async function loadCircuitBreakers() {
    try {
        const resp = await fetch('/api/health/circuits');
        const data = await resp.json();
        const container = document.getElementById('circuit-container');

        if (!data.circuits || Object.keys(data.circuits).length === 0) {
            container.innerHTML = '<div class="empty-state">No circuit breaker data yet</div>';
            return;
        }

        container.innerHTML = Object.entries(data.circuits).map(([name, info]) => `
            <div class="circuit-card">
                <div class="circuit-name">${escapeHtml(name)}</div>
                <div class="circuit-state ${info.state || 'CLOSED'}">${info.state || 'CLOSED'}</div>
                <div class="circuit-stats">
                    ${info.totalSuccesses || 0} ok / ${info.totalFailures || 0} fail
                </div>
            </div>
        `).join('');
    } catch (e) {
        document.getElementById('circuit-container').innerHTML =
            '<div class="empty-state">Failed to load circuit data</div>';
    }
}
</script>

<style>
/* Privacy Grid */
.privacy-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--spacing-lg);
}

.privacy-card {
    background: var(--glass-bg-elevated);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Privacy Score Ring */
.privacy-score-container {
    text-align: center;
}

.privacy-score-ring {
    position: relative;
    width: 120px;
    height: 120px;
    margin: 0 auto var(--spacing-md);
}

.privacy-score-ring svg {
    transform: rotate(-90deg);
}

.privacy-score-ring .ring-bg {
    fill: none;
    stroke: var(--md-sys-color-surface-variant);
    stroke-width: 10;
}

.privacy-score-ring .ring-fill {
    fill: none;
    stroke: var(--success);
    stroke-width: 10;
    stroke-linecap: round;
    transition: stroke-dashoffset 0.8s ease-out;
}

.privacy-score-value {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 28px;
    font-weight: 700;
    color: var(--md-sys-color-on-surface);
}

.privacy-score-label {
    font-size: 14px;
    color: var(--md-sys-color-on-surface-variant);
    margin-bottom: var(--spacing-xs);
}

.privacy-status {
    font-weight: 600;
    font-size: 16px;
}

.privacy-status.status-excellent { color: var(--success); }
.privacy-status.status-good { color: #4CAF50; }
.privacy-status.status-fair { color: var(--warning); }
.privacy-status.status-poor { color: var(--error); }

/* Risk Indicator */
.risk-indicator {
    text-align: center;
}

.risk-badge {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto var(--spacing-md);
    background: var(--md-sys-color-surface-variant);
}

.risk-badge.risk-minimal { background: rgba(76, 175, 80, 0.2); }
.risk-badge.risk-low { background: rgba(139, 195, 74, 0.2); }
.risk-badge.risk-medium { background: rgba(255, 193, 7, 0.2); }
.risk-badge.risk-high { background: rgba(217, 119, 87, 0.2); }

.risk-level {
    font-size: 14px;
    font-weight: 700;
    text-transform: uppercase;
}

.risk-minimal .risk-level { color: var(--success); }
.risk-low .risk-level { color: #8BC34A; }
.risk-medium .risk-level { color: var(--warning); }
.risk-high .risk-level { color: var(--error); }

.risk-label {
    font-size: 14px;
    color: var(--md-sys-color-on-surface-variant);
    margin-bottom: var(--spacing-sm);
}

.risk-details {
    display: flex;
    gap: var(--spacing-md);
    justify-content: center;
}

.risk-stat {
    font-size: 12px;
    color: var(--md-sys-color-on-surface-variant);
}

/* Token Stats */
.token-stats {
    text-align: center;
    width: 100%;
}

.token-total {
    margin-bottom: var(--spacing-lg);
}

.token-value {
    font-size: 36px;
    font-weight: 700;
    color: var(--md-sys-color-primary);
    display: block;
}

.token-label {
    font-size: 14px;
    color: var(--md-sys-color-on-surface-variant);
}

.token-breakdown {
    display: flex;
    justify-content: space-around;
    gap: var(--spacing-md);
}

.token-item {
    display: flex;
    flex-direction: column;
}

.token-type {
    font-size: 12px;
    color: var(--md-sys-color-on-surface-variant);
    margin-bottom: var(--spacing-xs);
}

.token-count {
    font-size: 18px;
    font-weight: 600;
    color: var(--md-sys-color-on-surface);
}

/* Category Breakdown */
.category-breakdown {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
}

.category-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    padding: var(--spacing-sm);
    background: var(--glass-bg-elevated);
    border-radius: var(--radius-md);
}

.category-icon {
    width: 40px;
    height: 40px;
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: white;
    flex-shrink: 0;
}

.category-info {
    flex: 1;
    min-width: 0;
}

.category-name {
    font-size: 14px;
    font-weight: 500;
    color: var(--md-sys-color-on-surface);
    display: block;
    margin-bottom: var(--spacing-xs);
    text-transform: capitalize;
}

.category-bar {
    height: 6px;
    background: var(--md-sys-color-surface-variant);
    border-radius: 3px;
    overflow: hidden;
}

.category-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.3s ease-out;
}

.category-count {
    font-size: 16px;
    font-weight: 600;
    color: var(--md-sys-color-on-surface-variant);
    min-width: 50px;
    text-align: right;
}

/* ========== Health Section Styles ========== */

/* Health category bars */
.health-category-bars { display: flex; flex-direction: column; gap: 12px; }
.health-bar-item { display: flex; align-items: center; gap: 8px; }
.health-bar-label { width: 120px; font-size: 13px; color: var(--md-sys-color-on-surface-variant); }
.health-bar-val { width: 40px; text-align: right; font-weight: 600; font-size: 13px; color: var(--md-sys-color-on-surface); }
.health-bar-bg { flex: 1; height: 8px; background: var(--md-sys-color-surface-variant); border-radius: 4px; overflow: hidden; }
.health-bar-fill { height: 100%; border-radius: 4px; transition: width 0.6s ease; }

/* Health quick stats */
.health-stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.health-stat { text-align: center; }
.health-stat-value { display: block; font-size: 24px; font-weight: 700; color: var(--md-sys-color-on-surface); }
.health-stat-label { display: block; font-size: 11px; color: var(--md-sys-color-on-surface-variant); margin-top: 4px; }

/* Alerts */
.alerts-list { display: flex; flex-direction: column; gap: 8px; }
.alert-card { padding: 12px 16px; border-radius: 8px; border-left: 4px solid; }
.alert-card.warning { border-color: #f59e0b; background: rgba(245, 158, 11, 0.1); }
.alert-card.critical { border-color: #ef4444; background: rgba(239, 68, 68, 0.1); }
.alert-card .alert-header { display: flex; justify-content: space-between; align-items: center; }
.alert-card .alert-metric { font-weight: 600; color: var(--md-sys-color-on-surface); }
.alert-card .alert-severity { font-size: 11px; padding: 2px 8px; border-radius: 12px; font-weight: 600; }
.alert-card.warning .alert-severity { background: #f59e0b; color: #000; }
.alert-card.critical .alert-severity { background: #ef4444; color: #fff; }
.alert-card .alert-message { font-size: 13px; color: var(--md-sys-color-on-surface-variant); margin-top: 4px; }
.alert-card .alert-recommendation { font-size: 12px; color: var(--md-sys-color-on-surface-variant); margin-top: 4px; font-style: italic; opacity: 0.7; }

/* Crash patterns */
.patterns-list { display: flex; flex-direction: column; gap: 8px; }
.pattern-card { padding: 12px 16px; background: var(--glass-bg-elevated); border: 1px solid var(--glass-border); border-radius: 8px; }
.pattern-card .pattern-header { display: flex; justify-content: space-between; }
.pattern-card .pattern-error { font-weight: 600; color: var(--md-sys-color-on-surface); }
.pattern-card .pattern-count { font-size: 13px; color: var(--accent); font-weight: 600; }
.pattern-card .pattern-file { font-size: 13px; color: var(--md-sys-color-on-surface-variant); }
.pattern-card .pattern-dates { font-size: 11px; color: var(--md-sys-color-on-surface-variant); opacity: 0.7; margin-top: 4px; }

/* Circuit breakers */
.circuit-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; }
.circuit-card { padding: 16px; background: var(--glass-bg-elevated); border: 1px solid var(--glass-border); border-radius: 8px; text-align: center; }
.circuit-card .circuit-name { font-weight: 600; text-transform: capitalize; margin-bottom: 8px; color: var(--md-sys-color-on-surface); }
.circuit-card .circuit-state { font-size: 13px; padding: 4px 12px; border-radius: 16px; display: inline-block; font-weight: 600; }
.circuit-card .circuit-state.CLOSED { background: #22c55e; color: #000; }
.circuit-card .circuit-state.OPEN { background: #ef4444; color: #fff; }
.circuit-card .circuit-state.HALF_OPEN { background: #f59e0b; color: #000; }
.circuit-card .circuit-stats { font-size: 11px; color: var(--md-sys-color-on-surface-variant); margin-top: 8px; }

.empty-state { text-align: center; padding: 24px; color: var(--md-sys-color-on-surface-variant); }
</style>
{% endblock %}
