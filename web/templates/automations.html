{% extends "base.html" %}

{% block title %}Shadow Web - Automations{% endblock %}
{% block page_title %}Automations{% endblock %}

{% block content %}
<div class="page-actions" style="justify-content: flex-end;">
    <button class="btn btn-primary" onclick="showAutomationModal()">
        <span class="material-symbols-outlined">add</span> Create New
    </button>
</div>

<div class="automations-grid" id="automations-container">
    <div class="loading">Loading automations...</div>
</div>

<section class="section">
    <h2>Execution History</h2>
    <div class="logs-list" id="execution-logs">
        <div class="empty-state">No recent executions</div>
    </div>
</section>

<!-- Automation Modal (Create/Edit) -->
<div id="automation-modal" class="modal hidden">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2 id="modal-title">Create Automation</h2>
            <button class="modal-close" onclick="closeAutomationModal()">&times;</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="edit-automation-id">

            <!-- Basic Info Section -->
            <div class="form-section">
                <h3>Basic Information</h3>
                <div class="form-group">
                    <label for="automation-name">Name *</label>
                    <input type="text" id="automation-name" class="form-input" placeholder="My Automation">
                </div>
                <div class="form-group">
                    <label for="automation-description">Description</label>
                    <textarea id="automation-description" class="form-input" rows="2" placeholder="What does this automation do?"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="automation-icon">Icon</label>
                        <select id="automation-icon" class="form-input">
                            <option value="ic_automation">Default</option>
                            <option value="ic_code">Code</option>
                            <option value="ic_terminal">Terminal</option>
                            <option value="ic_schedule">Schedule</option>
                            <option value="ic_sync">Sync</option>
                            <option value="ic_cloud">Cloud</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="automation-color">Color</label>
                        <input type="color" id="automation-color" class="form-input" value="#FF9800">
                    </div>
                </div>
            </div>

            <!-- Trigger Section -->
            <div class="form-section">
                <h3>Trigger Configuration</h3>
                <div class="form-group">
                    <label for="automation-trigger">Trigger Type</label>
                    <select id="automation-trigger" class="form-input" onchange="updateTriggerUI()">
                        <option value="MANUAL">Manual</option>
                        <option value="SCHEDULED">Scheduled</option>
                        <option value="ON_NOTE_UPDATE">On Note Update</option>
                        <option value="ON_PROJECT_CHANGE">On Project Change</option>
                        <option value="ON_SSH_CONNECT">On SSH Connect</option>
                        <option value="VOICE_TRIGGERED">Voice Triggered</option>
                        <option value="ON_AGENT_COMPLETE">On Agent Complete</option>
                        <option value="ON_CODE_COMMIT">On Code Commit</option>
                        <option value="ON_WEBHOOK">On Webhook</option>
                        <option value="ON_APPROVAL">On Approval</option>
                    </select>
                </div>

                <!-- Schedule Options -->
                <div id="schedule-options" class="trigger-options hidden">
                    <div class="form-group">
                        <label>Schedule Presets</label>
                        <div class="chip-group">
                            <button class="chip" onclick="setSchedule('*/15 * * * *', 'Every 15 minutes')">Every 15 min</button>
                            <button class="chip" onclick="setSchedule('*/30 * * * *', 'Every 30 minutes')">Every 30 min</button>
                            <button class="chip" onclick="setSchedule('0 * * * *', 'Every hour')">Hourly</button>
                            <button class="chip" onclick="setSchedule('0 9 * * *', 'Daily at 9:00 AM')">Daily</button>
                            <button class="chip" onclick="setSchedule('0 9 * * 1', 'Every Monday at 9:00 AM')">Weekly</button>
                            <button class="chip" onclick="setSchedule('0 9 * * 1-5', 'Weekdays at 9:00 AM')">Weekdays</button>
                            <button class="chip" onclick="setSchedule('0 10 * * 0,6', 'Weekends at 10:00 AM')">Weekends</button>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="automation-schedule">Cron Expression</label>
                            <input type="text" id="automation-schedule" class="form-input" placeholder="0 9 * * *">
                        </div>
                        <div class="form-group">
                            <label for="automation-timezone">Timezone</label>
                            <select id="automation-timezone" class="form-input">
                                <option value="">Device Default</option>
                                <option value="America/New_York">Eastern (New York)</option>
                                <option value="America/Chicago">Central (Chicago)</option>
                                <option value="America/Denver">Mountain (Denver)</option>
                                <option value="America/Los_Angeles">Pacific (Los Angeles)</option>
                                <option value="UTC">UTC</option>
                                <option value="Europe/London">London</option>
                                <option value="Europe/Paris">Paris</option>
                                <option value="Asia/Tokyo">Tokyo</option>
                                <option value="Asia/Shanghai">Shanghai</option>
                            </select>
                        </div>
                    </div>
                    <div class="schedule-preview" id="schedule-preview">Schedule: Not set</div>
                </div>

                <!-- Voice Trigger Options -->
                <div id="voice-options" class="trigger-options hidden">
                    <div class="form-group">
                        <label for="automation-voice-phrase">Voice Trigger Phrase</label>
                        <input type="text" id="automation-voice-phrase" class="form-input" placeholder="e.g., 'run daily report'">
                        <small class="help-text">Say this phrase to trigger the automation</small>
                    </div>
                </div>
            </div>

            <!-- AI Command Section -->
            <div class="form-section">
                <h3>AI Command</h3>
                <div class="form-group">
                    <label for="automation-command">Command *</label>
                    <textarea id="automation-command" class="form-input command-textarea" rows="5"
                        placeholder="What should the AI do? e.g., 'Summarize my notes from today and create action items'"></textarea>
                    <div class="command-stats">
                        <span id="command-length">0</span> / 5000 characters
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="automation-permission">AI Permission Level</label>
                        <select id="automation-permission" class="form-input">
                            <option value="FULL">Full Access</option>
                            <option value="READ_ONLY">Read Only</option>
                            <option value="NONE">None (Ask for each)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-checkbox" style="margin-top: 28px;">
                            <input type="checkbox" id="automation-use-context" checked> Use Note/Project as Context
                        </label>
                    </div>
                </div>
            </div>

            <!-- Execution Settings -->
            <div class="form-section">
                <h3>Execution Settings</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="automation-mode">Execution Mode</label>
                        <select id="automation-mode" class="form-input" onchange="updateModeUI()">
                            <option value="SINGLE_SHOT">Single Shot</option>
                            <option value="MULTI_AGENT">Multi-Agent (Team)</option>
                        </select>
                    </div>
                    <div class="form-group" id="team-type-group" style="display: none;">
                        <label for="automation-team">Team Type</label>
                        <select id="automation-team" class="form-input">
                            <option value="DEV">Development</option>
                            <option value="MARKETING">Marketing</option>
                            <option value="DESIGN">Design</option>
                            <option value="DEVOPS">DevOps</option>
                            <option value="RESEARCH">Research</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="automation-iterations">Max Iterations</label>
                        <input type="number" id="automation-iterations" class="form-input" value="50" min="10" max="200">
                    </div>
                    <div class="form-group">
                        <label for="automation-timeout">Timeout (minutes)</label>
                        <input type="number" id="automation-timeout" class="form-input" value="30" min="5" max="120">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-checkbox">
                        <input type="checkbox" id="automation-autonomous-edits"> Allow Autonomous File Edits
                    </label>
                </div>
            </div>

            <!-- Approval Triggers -->
            <div class="form-section">
                <h3>Approval Triggers</h3>
                <small class="help-text">Require approval before these actions</small>
                <div class="approval-grid">
                    <label class="form-checkbox">
                        <input type="checkbox" name="approval" value="FILE_DELETE"> File Delete
                    </label>
                    <label class="form-checkbox">
                        <input type="checkbox" name="approval" value="FILE_MODIFY"> File Modify
                    </label>
                    <label class="form-checkbox">
                        <input type="checkbox" name="approval" value="GIT_PUSH"> Git Push
                    </label>
                    <label class="form-checkbox">
                        <input type="checkbox" name="approval" value="DEPLOY"> Deploy
                    </label>
                    <label class="form-checkbox">
                        <input type="checkbox" name="approval" value="HTTP_REQUEST"> HTTP Request
                    </label>
                    <label class="form-checkbox">
                        <input type="checkbox" name="approval" value="COMMAND_EXECUTE"> Command Execute
                    </label>
                </div>
            </div>

            <!-- Output Settings -->
            <div class="form-section">
                <h3>Output Settings</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="automation-output">Output Destination</label>
                        <select id="automation-output" class="form-input" onchange="updateOutputUI()">
                            <option value="SHOW_DIALOG">Show Dialog</option>
                            <option value="CREATE_NOTE">Create New Note</option>
                            <option value="UPDATE_SOURCE">Update Source Note</option>
                            <option value="SAVE_TO_FILE">Save to File</option>
                            <option value="ASK_USER">Ask User</option>
                        </select>
                    </div>
                    <div class="form-group" id="output-title-group" style="display: none;">
                        <label for="automation-output-title">Note Title</label>
                        <input type="text" id="automation-output-title" class="form-input" placeholder="Output note title">
                    </div>
                </div>
                <div class="form-group" id="output-file-group" style="display: none;">
                    <label for="automation-output-file">Output File Path</label>
                    <input type="text" id="automation-output-file" class="form-input" placeholder="path/to/output.txt">
                </div>
            </div>

            <!-- Enable/Disable -->
            <div class="form-section">
                <label class="form-checkbox">
                    <input type="checkbox" id="automation-enabled" checked> Enabled
                </label>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeAutomationModal()">Cancel</button>
            <button class="btn btn-primary" id="save-automation-btn" onclick="saveAutomation()">Create</button>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="delete-modal" class="modal hidden">
    <div class="modal-content modal-small">
        <div class="modal-header">
            <h2>Delete Automation</h2>
            <button class="modal-close" onclick="closeDeleteModal()">&times;</button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete "<span id="delete-automation-name"></span>"?</p>
            <p class="warning-text">This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
            <button class="btn btn-danger" onclick="confirmDelete()">Delete</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let editingAutomationId = null;
let deleteAutomationId = null;

document.addEventListener('DOMContentLoaded', function() {
    loadAutomations();

    // Command length counter
    document.getElementById('automation-command').addEventListener('input', function() {
        document.getElementById('command-length').textContent = this.value.length;
    });
});

async function loadAutomations() {
    const automations = await api.getAutomations();
    const container = document.getElementById('automations-container');

    if (automations.length === 0) {
        container.innerHTML = '<div class="empty-state">No automations configured. Create one to get started!</div>';
        return;
    }

    container.innerHTML = automations.map(a => `
        <div class="automation-card ${a.enabled ? '' : 'disabled'}" data-id="${a.id}">
            <div class="automation-header">
                <div class="automation-name">${escapeHtml(a.name)}</div>
                <div class="automation-controls">
                    <button class="btn-icon" onclick="toggleEnabled('${a.id}')" title="${a.enabled ? 'Disable' : 'Enable'}">
                        <span class="material-symbols-outlined">${a.enabled ? 'toggle_on' : 'toggle_off'}</span>
                    </button>
                    <button class="btn-icon" onclick="editAutomation('${a.id}')" title="Edit">
                        <span class="material-symbols-outlined">edit</span>
                    </button>
                    <button class="btn-icon btn-danger-icon" onclick="showDeleteModal('${a.id}', '${escapeHtml(a.name)}')" title="Delete">
                        <span class="material-symbols-outlined">delete</span>
                    </button>
                </div>
            </div>
            <div class="automation-description">${escapeHtml(a.description || 'No description')}</div>
            <div class="automation-meta">
                <span class="trigger-badge">${formatTrigger(a.trigger)}</span>
                <span class="last-run">Last: ${a.last_run_formatted}</span>
            </div>
            <div class="automation-actions">
                <button class="btn btn-small btn-primary" onclick="runAutomation('${a.id}')" ${a.enabled ? '' : 'disabled'}>
                    <span class="material-symbols-outlined">play_arrow</span> Run Now
                </button>
                <button class="btn btn-small btn-secondary" onclick="viewLogs('${a.id}')">
                    <span class="material-symbols-outlined">history</span> Logs
                </button>
            </div>
        </div>
    `).join('');
}

function formatTrigger(trigger) {
    const triggerMap = {
        'MANUAL': 'ðŸ–ï¸ Manual',
        'SCHEDULED': 'â° Scheduled',
        'ON_NOTE_UPDATE': 'ðŸ“ Note Update',
        'ON_PROJECT_CHANGE': 'ðŸ“ Project Change',
        'ON_SSH_CONNECT': 'ðŸ”Œ SSH Connect',
        'VOICE_TRIGGERED': 'ðŸŽ¤ Voice',
        'ON_AGENT_COMPLETE': 'ðŸ¤– Agent Done',
        'ON_CODE_COMMIT': 'ðŸ“¤ Code Commit',
        'ON_WEBHOOK': 'ðŸŒ Webhook',
        'ON_APPROVAL': 'âœ… Approval'
    };
    return triggerMap[trigger] || trigger;
}

async function toggleEnabled(id) {
    try {
        const result = await fetch(`/api/automations/${id}/toggle`, { method: 'POST' });
        const data = await result.json();
        if (data.success) {
            showToast(`Automation ${data.enabled ? 'enabled' : 'disabled'}`, 'success');
            loadAutomations();
        } else {
            showToast('Failed to toggle: ' + (data.error || 'Unknown error'), 'error');
        }
    } catch (e) {
        showToast('Failed to toggle automation', 'error');
    }
}

async function editAutomation(id) {
    try {
        const response = await fetch(`/api/automations/${id}`);
        const auto = await response.json();
        if (auto.error) {
            showToast('Automation not found', 'error');
            return;
        }

        editingAutomationId = id;
        document.getElementById('modal-title').textContent = 'Edit Automation';
        document.getElementById('save-automation-btn').textContent = 'Save Changes';
        document.getElementById('edit-automation-id').value = id;

        // Populate form
        document.getElementById('automation-name').value = auto.name || '';
        document.getElementById('automation-description').value = auto.description || '';
        document.getElementById('automation-icon').value = auto.icon_name || 'ic_automation';
        document.getElementById('automation-color').value = auto.color || '#FF9800';
        document.getElementById('automation-trigger').value = auto.trigger_type || 'MANUAL';
        document.getElementById('automation-schedule').value = auto.schedule_expression || '';
        document.getElementById('automation-timezone').value = auto.schedule_timezone || '';
        document.getElementById('automation-voice-phrase').value = auto.voice_trigger_phrase || '';
        document.getElementById('automation-command').value = auto.ai_command || '';
        document.getElementById('command-length').textContent = (auto.ai_command || '').length;
        document.getElementById('automation-permission').value = auto.ai_permission_level || 'FULL';
        document.getElementById('automation-use-context').checked = auto.use_note_as_context !== false;
        document.getElementById('automation-mode').value = auto.execution_mode || 'SINGLE_SHOT';
        document.getElementById('automation-team').value = auto.team_type || 'DEV';
        document.getElementById('automation-iterations').value = auto.max_iterations || 50;
        document.getElementById('automation-timeout').value = auto.timeout_minutes || 30;
        document.getElementById('automation-autonomous-edits').checked = auto.allow_autonomous_edits === true;
        document.getElementById('automation-output').value = auto.output_destination || 'SHOW_DIALOG';
        document.getElementById('automation-output-title').value = auto.output_note_title || '';
        document.getElementById('automation-output-file').value = auto.output_file_path || '';
        document.getElementById('automation-enabled').checked = auto.enabled !== false;

        // Set approval triggers
        document.querySelectorAll('input[name="approval"]').forEach(cb => {
            cb.checked = (auto.require_approval_for || []).includes(cb.value);
        });

        updateTriggerUI();
        updateModeUI();
        updateOutputUI();

        document.getElementById('automation-modal').classList.remove('hidden');
    } catch (e) {
        showToast('Failed to load automation', 'error');
    }
}

function showAutomationModal() {
    editingAutomationId = null;
    document.getElementById('modal-title').textContent = 'Create Automation';
    document.getElementById('save-automation-btn').textContent = 'Create';
    document.getElementById('edit-automation-id').value = '';

    // Clear form
    document.getElementById('automation-name').value = '';
    document.getElementById('automation-description').value = '';
    document.getElementById('automation-icon').value = 'ic_automation';
    document.getElementById('automation-color').value = '#FF9800';
    document.getElementById('automation-trigger').value = 'MANUAL';
    document.getElementById('automation-schedule').value = '';
    document.getElementById('automation-timezone').value = '';
    document.getElementById('automation-voice-phrase').value = '';
    document.getElementById('automation-command').value = '';
    document.getElementById('command-length').textContent = '0';
    document.getElementById('automation-permission').value = 'FULL';
    document.getElementById('automation-use-context').checked = true;
    document.getElementById('automation-mode').value = 'SINGLE_SHOT';
    document.getElementById('automation-team').value = 'DEV';
    document.getElementById('automation-iterations').value = 50;
    document.getElementById('automation-timeout').value = 30;
    document.getElementById('automation-autonomous-edits').checked = false;
    document.getElementById('automation-output').value = 'SHOW_DIALOG';
    document.getElementById('automation-output-title').value = '';
    document.getElementById('automation-output-file').value = '';
    document.getElementById('automation-enabled').checked = true;

    document.querySelectorAll('input[name="approval"]').forEach(cb => cb.checked = false);

    updateTriggerUI();
    updateModeUI();
    updateOutputUI();

    document.getElementById('automation-modal').classList.remove('hidden');
}

function closeAutomationModal() {
    document.getElementById('automation-modal').classList.add('hidden');
    editingAutomationId = null;
}

function updateTriggerUI() {
    const trigger = document.getElementById('automation-trigger').value;
    document.getElementById('schedule-options').classList.toggle('hidden', trigger !== 'SCHEDULED');
    document.getElementById('voice-options').classList.toggle('hidden', trigger !== 'VOICE_TRIGGERED');
}

function updateModeUI() {
    const mode = document.getElementById('automation-mode').value;
    document.getElementById('team-type-group').style.display = mode === 'MULTI_AGENT' ? 'block' : 'none';
}

function updateOutputUI() {
    const output = document.getElementById('automation-output').value;
    document.getElementById('output-title-group').style.display = output === 'CREATE_NOTE' ? 'block' : 'none';
    document.getElementById('output-file-group').style.display = output === 'SAVE_TO_FILE' ? 'block' : 'none';
}

function setSchedule(cron, description) {
    document.getElementById('automation-schedule').value = cron;
    document.getElementById('schedule-preview').textContent = 'Schedule: ' + description;
}

async function saveAutomation() {
    const name = document.getElementById('automation-name').value.trim();
    if (!name) {
        showToast('Please enter an automation name', 'warning');
        return;
    }

    const command = document.getElementById('automation-command').value.trim();
    if (!command) {
        showToast('Please enter an AI command', 'warning');
        return;
    }

    const approvalTriggers = [];
    document.querySelectorAll('input[name="approval"]:checked').forEach(cb => {
        approvalTriggers.push(cb.value);
    });

    const data = {
        name: name,
        description: document.getElementById('automation-description').value.trim(),
        icon_name: document.getElementById('automation-icon').value,
        color: document.getElementById('automation-color').value,
        trigger_type: document.getElementById('automation-trigger').value,
        schedule_expression: document.getElementById('automation-schedule').value.trim() || null,
        schedule_timezone: document.getElementById('automation-timezone').value || null,
        voice_trigger_phrase: document.getElementById('automation-voice-phrase').value.trim() || null,
        ai_command: command,
        ai_permission_level: document.getElementById('automation-permission').value,
        use_note_as_context: document.getElementById('automation-use-context').checked,
        execution_mode: document.getElementById('automation-mode').value,
        team_type: document.getElementById('automation-team').value,
        max_iterations: parseInt(document.getElementById('automation-iterations').value) || 50,
        timeout_minutes: parseInt(document.getElementById('automation-timeout').value) || 30,
        allow_autonomous_edits: document.getElementById('automation-autonomous-edits').checked,
        require_approval_for: approvalTriggers,
        output_destination: document.getElementById('automation-output').value,
        output_note_title: document.getElementById('automation-output-title').value.trim() || null,
        output_file_path: document.getElementById('automation-output-file').value.trim() || null,
        enabled: document.getElementById('automation-enabled').checked,
        device_id: getDeviceIdParam() || 'web'
    };

    try {
        let result;
        if (editingAutomationId) {
            const response = await fetch(`/api/automations/${editingAutomationId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            result = await response.json();
        } else {
            result = await api.createAutomation(data);
        }

        if (result.success) {
            showToast(editingAutomationId ? 'Automation updated' : 'Automation created', 'success');
            closeAutomationModal();
            loadAutomations();
        } else {
            showToast('Failed: ' + (result.error || 'Unknown error'), 'error');
        }
    } catch (e) {
        showToast('Failed to save automation', 'error');
    }
}

function showDeleteModal(id, name) {
    deleteAutomationId = id;
    document.getElementById('delete-automation-name').textContent = name;
    document.getElementById('delete-modal').classList.remove('hidden');
}

function closeDeleteModal() {
    document.getElementById('delete-modal').classList.add('hidden');
    deleteAutomationId = null;
}

async function confirmDelete() {
    if (!deleteAutomationId) return;

    try {
        const response = await fetch(`/api/automations/${deleteAutomationId}`, { method: 'DELETE' });
        const result = await response.json();
        if (result.success) {
            showToast('Automation deleted', 'success');
            closeDeleteModal();
            loadAutomations();
        } else {
            showToast('Failed to delete: ' + (result.error || 'Unknown error'), 'error');
        }
    } catch (e) {
        showToast('Failed to delete automation', 'error');
    }
}

async function runAutomation(id) {
    try {
        const result = await api.runAutomation(id);
        if (result.error) {
            showToast('Error: ' + result.error, 'warning');
        } else {
            showToast('Automation triggered', 'success');
            loadAutomations();
        }
    } catch (e) {
        showToast('Failed to trigger automation', 'error');
    }
}

async function viewLogs(id) {
    const logs = await api.getAutomationLogs(id);
    const logsContainer = document.getElementById('execution-logs');

    if (logs.length === 0) {
        logsContainer.innerHTML = '<div class="empty-state">No execution logs for this automation</div>';
        return;
    }

    logsContainer.innerHTML = logs.map(l => `
        <div class="log-item ${l.success ? 'success' : 'error'}">
            <span class="log-time">${l.timestamp}</span>
            <span class="log-status">${l.success ? 'Success' : 'Failed'}</span>
            <span class="log-message">${escapeHtml(l.message || '')}</span>
        </div>
    `).join('');
}
</script>

<style>
.modal-large {
    max-width: 800px;
}

.modal-small {
    max-width: 400px;
}

.form-section {
    margin-bottom: var(--spacing-lg);
    padding-bottom: var(--spacing-lg);
    border-bottom: 1px solid var(--border);
}

.form-section:last-of-type {
    border-bottom: none;
    margin-bottom: 0;
}

.form-section h3 {
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
    margin-bottom: var(--spacing-md);
}

.form-row {
    display: flex;
    gap: var(--spacing-md);
}

.form-row .form-group {
    flex: 1;
}

.form-checkbox {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-size: 14px;
    color: var(--text);
    cursor: pointer;
}

.form-checkbox input {
    cursor: pointer;
    width: 16px;
    height: 16px;
}

.command-textarea {
    font-family: 'Consolas', 'Monaco', monospace;
    resize: vertical;
}

.command-stats {
    font-size: 12px;
    color: var(--text-secondary);
    text-align: right;
    margin-top: 4px;
}

.help-text {
    font-size: 12px;
    color: var(--text-secondary);
    display: block;
    margin-top: 4px;
}

.trigger-options {
    margin-top: var(--spacing-md);
    padding: var(--spacing-md);
    background: var(--surface);
    border-radius: var(--radius);
}

.trigger-options.hidden {
    display: none;
}

.chip-group {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-xs);
    margin-top: var(--spacing-sm);
}

.chip {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 6px 12px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
}

.chip:hover {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

.schedule-preview {
    margin-top: var(--spacing-sm);
    font-size: 13px;
    color: var(--primary);
    font-style: italic;
}

.approval-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--spacing-sm);
    margin-top: var(--spacing-sm);
}

.automation-controls {
    display: flex;
    gap: var(--spacing-xs);
}

.btn-icon {
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px;
    border-radius: var(--radius);
    color: var(--text-secondary);
    transition: all 0.2s;
}

.btn-icon:hover {
    background: var(--surface);
    color: var(--text);
}

.btn-danger-icon:hover {
    background: rgba(244, 67, 54, 0.1);
    color: #f44336;
}

.trigger-badge {
    background: var(--surface);
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 12px;
}

.warning-text {
    color: #f44336;
    font-size: 14px;
}

.btn-danger {
    background: #f44336;
    color: white;
}

.btn-danger:hover {
    background: #d32f2f;
}

@media (max-width: 600px) {
    .form-row {
        flex-direction: column;
    }

    .approval-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>
{% endblock %}
